{"ast":null,"code":"import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\n\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n\n  function Logger(props) {\n    var _this;\n\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin({\n      maxSize: _this.editorConfig.loggerMaxSize\n    }); // 注册API\n\n    _this.editor.registerPluginApi('undo', _this.handleUndo);\n\n    _this.editor.registerPluginApi('redo', _this.handleRedo);\n\n    return _this;\n  }\n\n  var _proto = Logger.prototype;\n\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleChange = function handleChange(value, e, isNotInput) {\n    var _this2 = this;\n\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n\n    this.logger.cleanRedo();\n\n    if (isNotInput) {\n      // from setText API call, not a input\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n\n        _this2.lastPop = null;\n\n        _this2.forceUpdate();\n      }\n\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, this.editorConfig.loggerInterval);\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this; // 监听变化事件\n\n\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n\n    this.editor.off('change', this.handleChange);\n    this.editor.unregisterPluginApi('undo');\n    this.editor.unregisterPluginApi('redo');\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n\n  return Logger;\n}(PluginComponent);\n\nLogger.pluginName = 'logger';\nexport { Logger as default };","map":{"version":3,"sources":["C:/Users/Admin/Desktop/LEARN REACTJS/Frontend-ReactJS-QuickStart/node_modules/react-markdown-editor-lite/esm/plugins/logger/index.js"],"names":["_assertThisInitialized","_inheritsLoose","React","Icon","i18n","PluginComponent","LoggerPlugin","Logger","_PluginComponent","props","_this","call","handleKeyboards","lastPop","handleChange","bind","handleRedo","handleUndo","key","keyCode","withKey","callback","aliasCommand","logger","maxSize","editorConfig","loggerMaxSize","editor","registerPluginApi","_proto","prototype","last","undo","getMdValue","pause","setText","forceUpdate","redo","value","e","isNotInput","_this2","getLast","cleanRedo","push","timerId","window","clearTimeout","setTimeout","loggerInterval","componentDidMount","_this3","on","forEach","it","onKeyboard","initValue","componentWillUnmount","_this4","off","unregisterPluginApi","offKeyboard","undefined","render","hasUndo","getUndoCount","hasRedo","getRedoCount","createElement","Fragment","className","title","get","onClick","type","pluginName","default"],"mappings":"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","sourcesContent":["import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\n\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n\n  function Logger(props) {\n    var _this;\n\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin({\n      maxSize: _this.editorConfig.loggerMaxSize\n    }); // 注册API\n\n    _this.editor.registerPluginApi('undo', _this.handleUndo);\n\n    _this.editor.registerPluginApi('redo', _this.handleRedo);\n\n    return _this;\n  }\n\n  var _proto = Logger.prototype;\n\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleChange = function handleChange(value, e, isNotInput) {\n    var _this2 = this;\n\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n\n    this.logger.cleanRedo();\n\n    if (isNotInput) {\n      // from setText API call, not a input\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n\n        _this2.lastPop = null;\n\n        _this2.forceUpdate();\n      }\n\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, this.editorConfig.loggerInterval);\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this;\n\n    // 监听变化事件\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n\n    this.editor.off('change', this.handleChange);\n    this.editor.unregisterPluginApi('undo');\n    this.editor.unregisterPluginApi('redo');\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n\n  return Logger;\n}(PluginComponent);\n\nLogger.pluginName = 'logger';\nexport { Logger as default };"]},"metadata":{},"sourceType":"module"}