{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) {\n  var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"];\n  if (it) return (it = it.call(o)).next.bind(it);\n\n  if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") {\n    if (it) o = it;\n    var i = 0;\n    return function () {\n      if (i >= o.length) return {\n        done: true\n      };\n      return {\n        done: false,\n        value: o[i++]\n      };\n    };\n  }\n\n  throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nimport * as React from 'react';\nimport { v4 as uuid } from 'uuid';\nimport Icon from '../components/Icon';\nimport NavigationBar from '../components/NavigationBar';\nimport ToolBar from '../components/ToolBar';\nimport i18n from '../i18n';\nimport DividerPlugin from '../plugins/divider';\nimport Emitter, { globalEmitter } from '../share/emitter';\nimport { initialSelection } from '../share/var';\nimport getDecorated from '../utils/decorate';\nimport mergeConfig from '../utils/mergeConfig';\nimport { getLineAndCol, isKeyMatch, isPromise } from '../utils/tool';\nimport getUploadPlaceholder from '../utils/uploadPlaceholder';\nimport defaultConfig from './defaultConfig';\nimport { HtmlRender } from './preview';\n\nvar Editor = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(Editor, _React$Component);\n  /**\n   * Register plugin\n   * @param {any} comp Plugin component\n   * @param {any} config Other configs\n   */\n\n\n  Editor.use = function use(comp, config) {\n    if (config === void 0) {\n      config = {};\n    } // Check for duplicate plugins\n\n\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1, {\n          comp: comp,\n          config: config\n        });\n        return;\n      }\n    }\n\n    Editor.plugins.push({\n      comp: comp,\n      config: config\n    });\n  }\n  /**\n   * Unregister plugin\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuse = function unuse(comp) {\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1);\n        return;\n      }\n    }\n  }\n  /**\n   * Unregister all plugins\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuseAll = function unuseAll() {\n    Editor.plugins = [];\n  }\n  /**\n   * Locales\n   */\n  ;\n\n  function Editor(props) {\n    var _this;\n\n    _this = _React$Component.call(this, props) || this;\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreview = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.hasContentChanged = true;\n    _this.composing = false;\n    _this.pluginApis = new Map();\n    _this.scrollScale = 1;\n    _this.isSyncingScroll = false;\n    _this.shouldSyncScroll = 'md';\n    _this.keyboardListeners = [];\n    _this.emitter = new Emitter();\n    _this.config = mergeConfig(defaultConfig, _this.props.config, _this.props);\n    _this.state = {\n      text: (_this.props.value || _this.props.defaultValue || '').replace(/↵/g, '\\n'),\n      html: '',\n      view: _this.config.view || defaultConfig.view,\n      fullScreen: false,\n      plugins: _this.getPlugins()\n    };\n\n    if (_this.config.canView && !_this.config.canView.menu) {\n      _this.state.view.menu = false;\n    }\n\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handlePaste = _this.handlePaste.bind(_assertThisInitialized(_this));\n    _this.handleDrop = _this.handleDrop.bind(_assertThisInitialized(_this));\n    _this.handleToggleMenu = _this.handleToggleMenu.bind(_assertThisInitialized(_this));\n    _this.handleKeyDown = _this.handleKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleEditorKeyDown = _this.handleEditorKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleLocaleUpdate = _this.handleLocaleUpdate.bind(_assertThisInitialized(_this));\n    _this.handleFocus = _this.handleFocus.bind(_assertThisInitialized(_this));\n    _this.handleBlur = _this.handleBlur.bind(_assertThisInitialized(_this));\n    _this.handleInputScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'md');\n    _this.handlePreviewScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'html');\n    return _this;\n  }\n\n  var _proto = Editor.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    var text = this.state.text;\n    this.renderHTML(text);\n    globalEmitter.on(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate); // init i18n\n\n    i18n.setUp();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    globalEmitter.off(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate);\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps) {\n    if (typeof this.props.value !== 'undefined' && this.props.value !== this.state.text) {\n      var value = this.props.value;\n\n      if (typeof value !== 'string') {\n        value = String(value).toString();\n      }\n\n      value = value.replace(/↵/g, '\\n');\n\n      if (this.state.text !== value) {\n        this.setState({\n          text: value\n        });\n        this.renderHTML(value);\n      }\n    }\n\n    if (prevProps.plugins !== this.props.plugins) {\n      this.setState({\n        plugins: this.getPlugins()\n      });\n    }\n  };\n\n  _proto.isComposing = function isComposing() {\n    return this.composing;\n  };\n\n  _proto.getPlugins = function getPlugins() {\n    var _this2 = this;\n\n    var plugins = [];\n\n    if (this.props.plugins) {\n      // If plugins option is configured, use only specified plugins\n      var addToPlugins = function addToPlugins(name) {\n        if (name === DividerPlugin.pluginName) {\n          plugins.push({\n            comp: DividerPlugin,\n            config: {}\n          });\n          return;\n        }\n\n        for (var _iterator = _createForOfIteratorHelperLoose(Editor.plugins), _step; !(_step = _iterator()).done;) {\n          var it = _step.value;\n\n          if (it.comp.pluginName === name) {\n            plugins.push(it);\n            return;\n          }\n        }\n      };\n\n      for (var _iterator2 = _createForOfIteratorHelperLoose(this.props.plugins), _step2; !(_step2 = _iterator2()).done;) {\n        var name = _step2.value; // Special handling of fonts to ensure backward compatibility\n\n        if (name === 'fonts') {\n          addToPlugins('font-bold');\n          addToPlugins('font-italic');\n          addToPlugins('font-underline');\n          addToPlugins('font-strikethrough');\n          addToPlugins('list-unordered');\n          addToPlugins('list-ordered');\n          addToPlugins('block-quote');\n          addToPlugins('block-wrap');\n          addToPlugins('block-code-inline');\n          addToPlugins('block-code-block');\n        } else {\n          addToPlugins(name);\n        }\n      }\n    } else {\n      // Use all registered plugins\n      plugins = [].concat(Editor.plugins);\n    }\n\n    var result = {};\n    plugins.forEach(function (it) {\n      if (typeof result[it.comp.align] === 'undefined') {\n        result[it.comp.align] = [];\n      }\n\n      var key = it.comp.pluginName === 'divider' ? uuid() : it.comp.pluginName;\n      result[it.comp.align].push( /*#__PURE__*/React.createElement(it.comp, {\n        editor: _this2,\n        editorConfig: _this2.config,\n        config: _extends({}, it.comp.defaultConfig || {}, it.config || {}),\n        key: key\n      }));\n    });\n    return result;\n  } // sync left and right section's scroll\n  ;\n\n  _proto.handleSyncScroll = function handleSyncScroll(type, e) {\n    var _this3 = this; // prevent loop\n\n\n    if (type !== this.shouldSyncScroll) {\n      return;\n    } // trigger events\n\n\n    if (this.props.onScroll) {\n      this.props.onScroll(e, type);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_SCROLL, e, type); // should sync scroll?\n\n    var _this$config$syncScro = this.config.syncScrollMode,\n        syncScrollMode = _this$config$syncScro === void 0 ? [] : _this$config$syncScro;\n\n    if (!syncScrollMode.includes(type === 'md' ? 'rightFollowLeft' : 'leftFollowRight')) {\n      return;\n    }\n\n    if (this.hasContentChanged && this.nodeMdText.current && this.nodeMdPreviewWrapper.current) {\n      // 计算出左右的比例\n      this.scrollScale = this.nodeMdText.current.scrollHeight / this.nodeMdPreviewWrapper.current.scrollHeight;\n      this.hasContentChanged = false;\n    }\n\n    if (!this.isSyncingScroll) {\n      this.isSyncingScroll = true;\n      requestAnimationFrame(function () {\n        if (_this3.nodeMdText.current && _this3.nodeMdPreviewWrapper.current) {\n          if (type === 'md') {\n            // left to right\n            _this3.nodeMdPreviewWrapper.current.scrollTop = _this3.nodeMdText.current.scrollTop / _this3.scrollScale;\n          } else {\n            // right to left\n            _this3.nodeMdText.current.scrollTop = _this3.nodeMdPreviewWrapper.current.scrollTop * _this3.scrollScale;\n          }\n        }\n\n        _this3.isSyncingScroll = false;\n      });\n    }\n  };\n\n  _proto.renderHTML = function renderHTML(markdownText) {\n    var _this4 = this;\n\n    if (!this.props.renderHTML) {\n      console.error('renderHTML props is required!');\n      return Promise.resolve();\n    }\n\n    var res = this.props.renderHTML(markdownText);\n\n    if (isPromise(res)) {\n      // @ts-ignore\n      return res.then(function (r) {\n        return _this4.setHtml(r);\n      });\n    }\n\n    if (typeof res === 'function') {\n      return this.setHtml(res());\n    }\n\n    return this.setHtml(res);\n  };\n\n  _proto.setHtml = function setHtml(html) {\n    var _this5 = this;\n\n    return new Promise(function (resolve) {\n      _this5.setState({\n        html: html\n      }, resolve);\n    });\n  };\n\n  _proto.handleToggleMenu = function handleToggleMenu() {\n    this.setView({\n      menu: !this.state.view.menu\n    });\n  };\n\n  _proto.handleFocus = function handleFocus(e) {\n    var onFocus = this.props.onFocus;\n\n    if (onFocus) {\n      onFocus(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_FOCUS, e);\n  };\n\n  _proto.handleBlur = function handleBlur(e) {\n    var onBlur = this.props.onBlur;\n\n    if (onBlur) {\n      onBlur(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_BLUR, e);\n  }\n  /**\n   * Text area change event\n   * @param {React.ChangeEvent} e\n   */\n  ;\n\n  _proto.handleChange = function handleChange(e) {\n    e.persist();\n    var value = e.target.value; // 触发内部事件\n\n    this.setText(value, e);\n  }\n  /**\n   * Listen paste event to support paste images\n   */\n  ;\n\n  _proto.handlePaste = function handlePaste(e) {\n    if (!this.config.allowPasteImage || !this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent; // @ts-ignore\n\n    var items = (event.clipboardData || window.clipboardData).items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  } // Drag images to upload\n  ;\n\n  _proto.handleDrop = function handleDrop(e) {\n    if (!this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent;\n\n    if (!event.dataTransfer) {\n      return;\n    }\n\n    var items = event.dataTransfer.items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  };\n\n  _proto.handleEditorKeyDown = function handleEditorKeyDown(e) {\n    var _this6 = this;\n\n    var keyCode = e.keyCode,\n        key = e.key,\n        currentTarget = e.currentTarget;\n\n    if ((keyCode === 13 || key === 'Enter') && this.composing === false) {\n      var _text = currentTarget.value;\n      var curPos = currentTarget.selectionStart;\n      var lineInfo = getLineAndCol(_text, curPos);\n\n      var emptyCurrentLine = function emptyCurrentLine() {\n        var newValue = currentTarget.value.substr(0, curPos - lineInfo.curLine.length) + currentTarget.value.substr(curPos);\n\n        _this6.setText(newValue, undefined, {\n          start: curPos - lineInfo.curLine.length,\n          end: curPos - lineInfo.curLine.length\n        });\n\n        e.preventDefault();\n      };\n\n      var addSymbol = function addSymbol(symbol) {\n        _this6.insertText(\"\\n\" + symbol, false, {\n          start: symbol.length + 1,\n          end: symbol.length + 1\n        });\n\n        e.preventDefault();\n      }; // Enter key, check previous line\n\n\n      var isSymbol = lineInfo.curLine.match(/^(\\s*?)\\* /);\n\n      if (isSymbol) {\n        if (/^(\\s*?)\\* $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        addSymbol(isSymbol[0]);\n        return;\n      }\n\n      var isOrderList = lineInfo.curLine.match(/^(\\s*?)(\\d+)\\. /);\n\n      if (isOrderList) {\n        if (/^(\\s*?)(\\d+)\\. $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        var toInsert = \"\" + isOrderList[1] + (parseInt(isOrderList[2], 10) + 1) + \". \";\n        addSymbol(toInsert);\n        return;\n      }\n    } // 触发默认事件\n\n\n    this.emitter.emit(this.emitter.EVENT_EDITOR_KEY_DOWN, e);\n  } // Handle language change\n  ;\n\n  _proto.handleLocaleUpdate = function handleLocaleUpdate() {\n    this.forceUpdate();\n  }\n  /**\n   * Get elements\n   */\n  ;\n\n  _proto.getMdElement = function getMdElement() {\n    return this.nodeMdText.current;\n  };\n\n  _proto.getHtmlElement = function getHtmlElement() {\n    return this.nodeMdPreviewWrapper.current;\n  }\n  /**\n   * Clear selected\n   */\n  ;\n\n  _proto.clearSelection = function clearSelection() {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(0, 0, 'none');\n    }\n  }\n  /**\n   * Get selected\n   * @return {Selection}\n   */\n  ;\n\n  _proto.getSelection = function getSelection() {\n    var source = this.nodeMdText.current;\n\n    if (!source) {\n      return _extends({}, initialSelection);\n    }\n\n    var start = source.selectionStart;\n    var end = source.selectionEnd;\n    var text = (source.value || '').slice(start, end);\n    return {\n      start: start,\n      end: end,\n      text: text\n    };\n  }\n  /**\n   * Set selected\n   * @param {Selection} to\n   */\n  ;\n\n  _proto.setSelection = function setSelection(to) {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(to.start, to.end, 'forward');\n      this.nodeMdText.current.focus();\n    }\n  }\n  /**\n   * Insert markdown text\n   * @param type\n   * @param option\n   */\n  ;\n\n  _proto.insertMarkdown = function insertMarkdown(type, option) {\n    if (option === void 0) {\n      option = {};\n    }\n\n    var curSelection = this.getSelection();\n    var decorateOption = option ? _extends({}, option) : {};\n\n    if (type === 'image') {\n      decorateOption = _extends({}, decorateOption, {\n        target: option.target || curSelection.text || '',\n        imageUrl: option.imageUrl || this.config.imageUrl\n      });\n    }\n\n    if (type === 'link') {\n      decorateOption = _extends({}, decorateOption, {\n        linkUrl: this.config.linkUrl\n      });\n    }\n\n    if (type === 'tab' && curSelection.start !== curSelection.end) {\n      var curLineStart = this.getMdValue().slice(0, curSelection.start).lastIndexOf('\\n') + 1;\n      this.setSelection({\n        start: curLineStart,\n        end: curSelection.end\n      });\n    }\n\n    var decorate = getDecorated(curSelection.text, type, decorateOption);\n    var text = decorate.text;\n    var selection = decorate.selection;\n\n    if (decorate.newBlock) {\n      var startLineInfo = getLineAndCol(this.getMdValue(), curSelection.start);\n      var col = startLineInfo.col,\n          curLine = startLineInfo.curLine;\n\n      if (col > 0 && curLine.length > 0) {\n        text = \"\\n\" + text;\n\n        if (selection) {\n          selection.start++;\n          selection.end++;\n        }\n      }\n\n      var afterText = startLineInfo.afterText;\n\n      if (curSelection.start !== curSelection.end) {\n        afterText = getLineAndCol(this.getMdValue(), curSelection.end).afterText;\n      }\n\n      if (afterText.trim() !== '' && afterText.substr(0, 2) !== '\\n\\n') {\n        if (afterText.substr(0, 1) !== '\\n') {\n          text += '\\n';\n        }\n\n        text += '\\n';\n      }\n    }\n\n    this.insertText(text, true, selection);\n  }\n  /**\n   * Insert a placeholder, and replace it when the Promise resolved\n   * @param placeholder\n   * @param wait\n   */\n  ;\n\n  _proto.insertPlaceholder = function insertPlaceholder(placeholder, wait) {\n    var _this7 = this;\n\n    this.insertText(placeholder, true);\n    wait.then(function (str) {\n      var text = _this7.getMdValue().replace(placeholder, str);\n\n      _this7.setText(text);\n    });\n  }\n  /**\n   * Insert text\n   * @param {string} value The text will be insert\n   * @param {boolean} replaceSelected Replace selected text\n   * @param {Selection} newSelection New selection\n   */\n  ;\n\n  _proto.insertText = function insertText(value, replaceSelected, newSelection) {\n    if (value === void 0) {\n      value = '';\n    }\n\n    if (replaceSelected === void 0) {\n      replaceSelected = false;\n    }\n\n    var text = this.state.text;\n    var selection = this.getSelection();\n    var beforeContent = text.slice(0, selection.start);\n    var afterContent = text.slice(replaceSelected ? selection.end : selection.start, text.length);\n    this.setText(beforeContent + value + afterContent, undefined, newSelection ? {\n      start: newSelection.start + beforeContent.length,\n      end: newSelection.end + beforeContent.length\n    } : {\n      start: selection.start,\n      end: selection.start\n    });\n  }\n  /**\n   * Set text, and trigger onChange event\n   * @param {string} value\n   * @param {any} event\n   */\n  ;\n\n  _proto.setText = function setText(value, event, newSelection) {\n    var _this8 = this;\n\n    if (value === void 0) {\n      value = '';\n    }\n\n    var _this$config$onChange = this.config.onChangeTrigger,\n        onChangeTrigger = _this$config$onChange === void 0 ? 'both' : _this$config$onChange;\n    var text = value.replace(/↵/g, '\\n');\n\n    if (this.state.text === value) {\n      return;\n    }\n\n    this.setState({\n      text: text\n    });\n\n    if (this.props.onChange && (onChangeTrigger === 'both' || onChangeTrigger === 'beforeRender')) {\n      this.props.onChange({\n        text: text,\n        html: this.getHtmlValue()\n      }, event);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_CHANGE, value, event, typeof event === 'undefined');\n\n    if (newSelection) {\n      setTimeout(function () {\n        return _this8.setSelection(newSelection);\n      });\n    }\n\n    if (!this.hasContentChanged) {\n      this.hasContentChanged = true;\n    }\n\n    var rendering = this.renderHTML(text);\n\n    if (onChangeTrigger === 'both' || onChangeTrigger === 'afterRender') {\n      rendering.then(function () {\n        if (_this8.props.onChange) {\n          _this8.props.onChange({\n            text: _this8.state.text,\n            html: _this8.getHtmlValue()\n          }, event);\n        }\n      });\n    }\n  }\n  /**\n   * Get text value\n   * @return {string}\n   */\n  ;\n\n  _proto.getMdValue = function getMdValue() {\n    return this.state.text;\n  }\n  /**\n   * Get rendered html\n   * @returns {string}\n   */\n  ;\n\n  _proto.getHtmlValue = function getHtmlValue() {\n    if (typeof this.state.html === 'string') {\n      return this.state.html;\n    }\n\n    if (this.nodeMdPreview.current) {\n      return this.nodeMdPreview.current.getHtml();\n    }\n\n    return '';\n  }\n  /**\n   * Listen keyboard events\n   */\n  ;\n  /**\n   * Listen keyboard events\n   * @param {KeyboardEventListener} data\n   */\n\n\n  _proto.onKeyboard = function onKeyboard(data) {\n    var _this9 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this9.onKeyboard(it);\n      });\n      return;\n    }\n\n    if (!this.keyboardListeners.includes(data)) {\n      this.keyboardListeners.push(data);\n    }\n  }\n  /**\n   * Un-listen keyboard events\n   * @param {KeyboardEventListener} data\n   */\n  ;\n\n  _proto.offKeyboard = function offKeyboard(data) {\n    var _this10 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this10.offKeyboard(it);\n      });\n      return;\n    }\n\n    var index = this.keyboardListeners.indexOf(data);\n\n    if (index >= 0) {\n      this.keyboardListeners.splice(index, 1);\n    }\n  };\n\n  _proto.handleKeyDown = function handleKeyDown(e) {\n    // 遍历监听数组，找找有没有被监听\n    for (var _iterator3 = _createForOfIteratorHelperLoose(this.keyboardListeners), _step3; !(_step3 = _iterator3()).done;) {\n      var it = _step3.value;\n\n      if (isKeyMatch(e, it)) {\n        e.preventDefault();\n        it.callback(e);\n        return;\n      }\n    } // 如果没有，触发默认事件\n\n\n    this.emitter.emit(this.emitter.EVENT_KEY_DOWN, e);\n  };\n\n  _proto.getEventType = function getEventType(event) {\n    switch (event) {\n      case 'change':\n        return this.emitter.EVENT_CHANGE;\n\n      case 'fullscreen':\n        return this.emitter.EVENT_FULL_SCREEN;\n\n      case 'viewchange':\n        return this.emitter.EVENT_VIEW_CHANGE;\n\n      case 'keydown':\n        return this.emitter.EVENT_KEY_DOWN;\n\n      case 'editor_keydown':\n        return this.emitter.EVENT_EDITOR_KEY_DOWN;\n\n      case 'blur':\n        return this.emitter.EVENT_BLUR;\n\n      case 'focus':\n        return this.emitter.EVENT_FOCUS;\n\n      case 'scroll':\n        return this.emitter.EVENT_SCROLL;\n    }\n  }\n  /**\n   * Listen events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.on = function on(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.on(eventType, cb);\n    }\n  }\n  /**\n   * Un-listen events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.off = function off(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.off(eventType, cb);\n    }\n  }\n  /**\n   * Set view property\n   * Can show or hide: editor, preview, menu\n   * @param {object} to\n   */\n  ;\n\n  _proto.setView = function setView(to) {\n    var _this11 = this;\n\n    var newView = _extends({}, this.state.view, to);\n\n    this.setState({\n      view: newView\n    }, function () {\n      _this11.emitter.emit(_this11.emitter.EVENT_VIEW_CHANGE, newView);\n    });\n  }\n  /**\n   * Get view property\n   * @return {object}\n   */\n  ;\n\n  _proto.getView = function getView() {\n    return _extends({}, this.state.view);\n  }\n  /**\n   * Enter or exit full screen\n   * @param {boolean} enable\n   */\n  ;\n\n  _proto.fullScreen = function fullScreen(enable) {\n    var _this12 = this;\n\n    if (this.state.fullScreen !== enable) {\n      this.setState({\n        fullScreen: enable\n      }, function () {\n        _this12.emitter.emit(_this12.emitter.EVENT_FULL_SCREEN, enable);\n      });\n    }\n  }\n  /**\n   * Register a plugin API\n   * @param {string} name API name\n   * @param {any} cb callback\n   */\n  ;\n\n  _proto.registerPluginApi = function registerPluginApi(name, cb) {\n    this.pluginApis.set(name, cb);\n  };\n\n  _proto.unregisterPluginApi = function unregisterPluginApi(name) {\n    this.pluginApis.delete(name);\n  }\n  /**\n   * Call a plugin API\n   * @param {string} name API name\n   * @param {any} others arguments\n   * @returns {any}\n   */\n  ;\n\n  _proto.callPluginApi = function callPluginApi(name) {\n    var handler = this.pluginApis.get(name);\n\n    if (!handler) {\n      throw new Error(\"API \" + name + \" not found\");\n    }\n\n    for (var _len = arguments.length, others = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      others[_key - 1] = arguments[_key];\n    }\n\n    return handler.apply(void 0, others);\n  }\n  /**\n   * Is full screen\n   * @return {boolean}\n   */\n  ;\n\n  _proto.isFullScreen = function isFullScreen() {\n    return this.state.fullScreen;\n  };\n\n  _proto.uploadWithDataTransfer = function uploadWithDataTransfer(items) {\n    var _this13 = this;\n\n    var onImageUpload = this.config.onImageUpload;\n\n    if (!onImageUpload) {\n      return;\n    }\n\n    var queue = [];\n    Array.prototype.forEach.call(items, function (it) {\n      if (it.kind === 'file' && it.type.includes('image')) {\n        var file = it.getAsFile();\n\n        if (file) {\n          var placeholder = getUploadPlaceholder(file, onImageUpload);\n          queue.push(Promise.resolve(placeholder.placeholder));\n          placeholder.uploaded.then(function (str) {\n            var text = _this13.getMdValue().replace(placeholder.placeholder, str);\n\n            var offset = str.length - placeholder.placeholder.length; // 计算出替换后的光标位置\n\n            var selection = _this13.getSelection();\n\n            _this13.setText(text, undefined, {\n              start: selection.start + offset,\n              end: selection.start + offset\n            });\n          });\n        }\n      } else if (it.kind === 'string' && it.type === 'text/plain') {\n        queue.push(new Promise(function (resolve) {\n          return it.getAsString(resolve);\n        }));\n      }\n    });\n    Promise.all(queue).then(function (res) {\n      var text = res.join('');\n\n      var selection = _this13.getSelection();\n\n      _this13.insertText(text, true, {\n        start: selection.start === selection.end ? text.length : 0,\n        end: text.length\n      });\n    });\n  };\n\n  _proto.render = function render() {\n    var _this14 = this;\n\n    var _this$state = this.state,\n        view = _this$state.view,\n        fullScreen = _this$state.fullScreen,\n        text = _this$state.text,\n        html = _this$state.html;\n    var _this$props = this.props,\n        id = _this$props.id,\n        _this$props$className = _this$props.className,\n        className = _this$props$className === void 0 ? '' : _this$props$className,\n        style = _this$props.style,\n        _this$props$name = _this$props.name,\n        name = _this$props$name === void 0 ? 'textarea' : _this$props$name,\n        autoFocus = _this$props.autoFocus,\n        placeholder = _this$props.placeholder,\n        readOnly = _this$props.readOnly;\n    var showHideMenu = this.config.canView && this.config.canView.hideMenu && !this.config.canView.menu;\n\n    var getPluginAt = function getPluginAt(at) {\n      return _this14.state.plugins[at] || [];\n    };\n\n    var isShowMenu = !!view.menu;\n    var editorId = id ? id + \"_md\" : undefined;\n    var previewerId = id ? id + \"_html\" : undefined;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: id,\n      className: \"rc-md-editor \" + (fullScreen ? 'full' : '') + \" \" + className,\n      style: style,\n      onKeyDown: this.handleKeyDown,\n      onDrop: this.handleDrop\n    }, /*#__PURE__*/React.createElement(NavigationBar, {\n      visible: isShowMenu,\n      left: getPluginAt('left'),\n      right: getPluginAt('right')\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"editor-container\"\n    }, showHideMenu && /*#__PURE__*/React.createElement(ToolBar, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-menu\",\n      title: isShowMenu ? 'hidden menu' : 'show menu',\n      onClick: this.handleToggleMenu\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"expand-\" + (isShowMenu ? 'less' : 'more')\n    }))), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-md \" + (view.md ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      id: editorId,\n      ref: this.nodeMdText,\n      name: name,\n      autoFocus: autoFocus,\n      placeholder: placeholder,\n      readOnly: readOnly,\n      value: text,\n      className: \"section-container input \" + (this.config.markdownClass || ''),\n      wrap: \"hard\",\n      onChange: this.handleChange,\n      onScroll: this.handleInputScroll,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'md';\n      },\n      onKeyDown: this.handleEditorKeyDown,\n      onCompositionStart: function onCompositionStart() {\n        return _this14.composing = true;\n      },\n      onCompositionEnd: function onCompositionEnd() {\n        return _this14.composing = false;\n      },\n      onPaste: this.handlePaste,\n      onFocus: this.handleFocus,\n      onBlur: this.handleBlur\n    })), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-html \" + (view.html ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: previewerId,\n      className: \"section-container html-wrap\",\n      ref: this.nodeMdPreviewWrapper,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'html';\n      },\n      onScroll: this.handlePreviewScroll\n    }, /*#__PURE__*/React.createElement(HtmlRender, {\n      html: html,\n      className: this.config.htmlClass,\n      ref: this.nodeMdPreview\n    })))));\n  };\n\n  return Editor;\n}(React.Component);\n\nEditor.plugins = [];\nEditor.addLocale = i18n.add.bind(i18n);\nEditor.useLocale = i18n.setCurrent.bind(i18n);\nEditor.getLocale = i18n.getCurrent.bind(i18n);\nexport default Editor;","map":{"version":3,"sources":["C:/Users/Admin/Desktop/LEARN REACTJS/Frontend-ReactJS-QuickStart/node_modules/react-markdown-editor-lite/esm/editor/index.js"],"names":["_extends","_assertThisInitialized","_inheritsLoose","_createForOfIteratorHelperLoose","o","allowArrayLike","it","Symbol","iterator","call","next","bind","Array","isArray","_unsupportedIterableToArray","length","i","done","value","TypeError","minLen","_arrayLikeToArray","n","Object","prototype","toString","slice","constructor","name","from","test","arr","len","arr2","React","v4","uuid","Icon","NavigationBar","ToolBar","i18n","DividerPlugin","Emitter","globalEmitter","initialSelection","getDecorated","mergeConfig","getLineAndCol","isKeyMatch","isPromise","getUploadPlaceholder","defaultConfig","HtmlRender","Editor","_React$Component","use","comp","config","plugins","splice","push","unuse","unuseAll","props","_this","nodeMdText","createRef","nodeMdPreview","nodeMdPreviewWrapper","hasContentChanged","composing","pluginApis","Map","scrollScale","isSyncingScroll","shouldSyncScroll","keyboardListeners","emitter","state","text","defaultValue","replace","html","view","fullScreen","getPlugins","canView","menu","handleChange","handlePaste","handleDrop","handleToggleMenu","handleKeyDown","handleEditorKeyDown","handleLocaleUpdate","handleFocus","handleBlur","handleInputScroll","handleSyncScroll","handlePreviewScroll","_proto","componentDidMount","renderHTML","on","EVENT_LANG_CHANGE","setUp","componentWillUnmount","off","componentDidUpdate","prevProps","String","setState","isComposing","_this2","addToPlugins","pluginName","_iterator","_step","_iterator2","_step2","concat","result","forEach","align","key","createElement","editor","editorConfig","type","e","_this3","onScroll","emit","EVENT_SCROLL","_this$config$syncScro","syncScrollMode","includes","current","scrollHeight","requestAnimationFrame","scrollTop","markdownText","_this4","console","error","Promise","resolve","res","then","r","setHtml","_this5","setView","onFocus","EVENT_FOCUS","onBlur","EVENT_BLUR","persist","target","setText","allowPasteImage","onImageUpload","event","nativeEvent","items","clipboardData","window","preventDefault","uploadWithDataTransfer","dataTransfer","_this6","keyCode","currentTarget","_text","curPos","selectionStart","lineInfo","emptyCurrentLine","newValue","substr","curLine","undefined","start","end","addSymbol","symbol","insertText","isSymbol","match","isOrderList","toInsert","parseInt","EVENT_EDITOR_KEY_DOWN","forceUpdate","getMdElement","getHtmlElement","clearSelection","setSelectionRange","getSelection","source","selectionEnd","setSelection","to","focus","insertMarkdown","option","curSelection","decorateOption","imageUrl","linkUrl","curLineStart","getMdValue","lastIndexOf","decorate","selection","newBlock","startLineInfo","col","afterText","trim","insertPlaceholder","placeholder","wait","_this7","str","replaceSelected","newSelection","beforeContent","afterContent","_this8","_this$config$onChange","onChangeTrigger","onChange","getHtmlValue","EVENT_CHANGE","setTimeout","rendering","getHtml","onKeyboard","data","_this9","offKeyboard","_this10","index","indexOf","_iterator3","_step3","callback","EVENT_KEY_DOWN","getEventType","EVENT_FULL_SCREEN","EVENT_VIEW_CHANGE","cb","eventType","_this11","newView","getView","enable","_this12","registerPluginApi","set","unregisterPluginApi","delete","callPluginApi","handler","get","Error","_len","arguments","others","_key","apply","isFullScreen","_this13","queue","kind","file","getAsFile","uploaded","offset","getAsString","all","join","render","_this14","_this$state","_this$props","id","_this$props$className","className","style","_this$props$name","autoFocus","readOnly","showHideMenu","hideMenu","getPluginAt","at","isShowMenu","editorId","previewerId","onKeyDown","onDrop","visible","left","right","title","onClick","md","ref","markdownClass","wrap","onMouseOver","onCompositionStart","onCompositionEnd","onPaste","htmlClass","Component","addLocale","add","useLocale","setCurrent","getLocale","getCurrent"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/extends\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\n\nfunction _createForOfIteratorHelperLoose(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (it) return (it = it.call(o)).next.bind(it); if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; return function () { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nimport * as React from 'react';\nimport { v4 as uuid } from 'uuid';\nimport Icon from '../components/Icon';\nimport NavigationBar from '../components/NavigationBar';\nimport ToolBar from '../components/ToolBar';\nimport i18n from '../i18n';\nimport DividerPlugin from '../plugins/divider';\nimport Emitter, { globalEmitter } from '../share/emitter';\nimport { initialSelection } from '../share/var';\nimport getDecorated from '../utils/decorate';\nimport mergeConfig from '../utils/mergeConfig';\nimport { getLineAndCol, isKeyMatch, isPromise } from '../utils/tool';\nimport getUploadPlaceholder from '../utils/uploadPlaceholder';\nimport defaultConfig from './defaultConfig';\nimport { HtmlRender } from './preview';\n\nvar Editor = /*#__PURE__*/function (_React$Component) {\n  _inheritsLoose(Editor, _React$Component);\n\n  /**\n   * Register plugin\n   * @param {any} comp Plugin component\n   * @param {any} config Other configs\n   */\n  Editor.use = function use(comp, config) {\n    if (config === void 0) {\n      config = {};\n    }\n\n    // Check for duplicate plugins\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1, {\n          comp: comp,\n          config: config\n        });\n        return;\n      }\n    }\n\n    Editor.plugins.push({\n      comp: comp,\n      config: config\n    });\n  }\n  /**\n   * Unregister plugin\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuse = function unuse(comp) {\n    for (var i = 0; i < Editor.plugins.length; i++) {\n      if (Editor.plugins[i].comp === comp) {\n        Editor.plugins.splice(i, 1);\n        return;\n      }\n    }\n  }\n  /**\n   * Unregister all plugins\n   * @param {any} comp Plugin component\n   */\n  ;\n\n  Editor.unuseAll = function unuseAll() {\n    Editor.plugins = [];\n  }\n  /**\n   * Locales\n   */\n  ;\n\n  function Editor(props) {\n    var _this;\n\n    _this = _React$Component.call(this, props) || this;\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreview = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.hasContentChanged = true;\n    _this.composing = false;\n    _this.pluginApis = new Map();\n    _this.scrollScale = 1;\n    _this.isSyncingScroll = false;\n    _this.shouldSyncScroll = 'md';\n    _this.keyboardListeners = [];\n    _this.emitter = new Emitter();\n    _this.config = mergeConfig(defaultConfig, _this.props.config, _this.props);\n    _this.state = {\n      text: (_this.props.value || _this.props.defaultValue || '').replace(/↵/g, '\\n'),\n      html: '',\n      view: _this.config.view || defaultConfig.view,\n      fullScreen: false,\n      plugins: _this.getPlugins()\n    };\n\n    if (_this.config.canView && !_this.config.canView.menu) {\n      _this.state.view.menu = false;\n    }\n\n    _this.nodeMdText = /*#__PURE__*/React.createRef();\n    _this.nodeMdPreviewWrapper = /*#__PURE__*/React.createRef();\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handlePaste = _this.handlePaste.bind(_assertThisInitialized(_this));\n    _this.handleDrop = _this.handleDrop.bind(_assertThisInitialized(_this));\n    _this.handleToggleMenu = _this.handleToggleMenu.bind(_assertThisInitialized(_this));\n    _this.handleKeyDown = _this.handleKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleEditorKeyDown = _this.handleEditorKeyDown.bind(_assertThisInitialized(_this));\n    _this.handleLocaleUpdate = _this.handleLocaleUpdate.bind(_assertThisInitialized(_this));\n    _this.handleFocus = _this.handleFocus.bind(_assertThisInitialized(_this));\n    _this.handleBlur = _this.handleBlur.bind(_assertThisInitialized(_this));\n    _this.handleInputScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'md');\n    _this.handlePreviewScroll = _this.handleSyncScroll.bind(_assertThisInitialized(_this), 'html');\n    return _this;\n  }\n\n  var _proto = Editor.prototype;\n\n  _proto.componentDidMount = function componentDidMount() {\n    var text = this.state.text;\n    this.renderHTML(text);\n    globalEmitter.on(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate); // init i18n\n\n    i18n.setUp();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    globalEmitter.off(globalEmitter.EVENT_LANG_CHANGE, this.handleLocaleUpdate);\n  };\n\n  _proto.componentDidUpdate = function componentDidUpdate(prevProps) {\n    if (typeof this.props.value !== 'undefined' && this.props.value !== this.state.text) {\n      var value = this.props.value;\n\n      if (typeof value !== 'string') {\n        value = String(value).toString();\n      }\n\n      value = value.replace(/↵/g, '\\n');\n\n      if (this.state.text !== value) {\n        this.setState({\n          text: value\n        });\n        this.renderHTML(value);\n      }\n    }\n\n    if (prevProps.plugins !== this.props.plugins) {\n      this.setState({\n        plugins: this.getPlugins()\n      });\n    }\n  };\n\n  _proto.isComposing = function isComposing() {\n    return this.composing;\n  };\n\n  _proto.getPlugins = function getPlugins() {\n    var _this2 = this;\n\n    var plugins = [];\n\n    if (this.props.plugins) {\n      // If plugins option is configured, use only specified plugins\n      var addToPlugins = function addToPlugins(name) {\n        if (name === DividerPlugin.pluginName) {\n          plugins.push({\n            comp: DividerPlugin,\n            config: {}\n          });\n          return;\n        }\n\n        for (var _iterator = _createForOfIteratorHelperLoose(Editor.plugins), _step; !(_step = _iterator()).done;) {\n          var it = _step.value;\n\n          if (it.comp.pluginName === name) {\n            plugins.push(it);\n            return;\n          }\n        }\n      };\n\n      for (var _iterator2 = _createForOfIteratorHelperLoose(this.props.plugins), _step2; !(_step2 = _iterator2()).done;) {\n        var name = _step2.value;\n\n        // Special handling of fonts to ensure backward compatibility\n        if (name === 'fonts') {\n          addToPlugins('font-bold');\n          addToPlugins('font-italic');\n          addToPlugins('font-underline');\n          addToPlugins('font-strikethrough');\n          addToPlugins('list-unordered');\n          addToPlugins('list-ordered');\n          addToPlugins('block-quote');\n          addToPlugins('block-wrap');\n          addToPlugins('block-code-inline');\n          addToPlugins('block-code-block');\n        } else {\n          addToPlugins(name);\n        }\n      }\n    } else {\n      // Use all registered plugins\n      plugins = [].concat(Editor.plugins);\n    }\n\n    var result = {};\n    plugins.forEach(function (it) {\n      if (typeof result[it.comp.align] === 'undefined') {\n        result[it.comp.align] = [];\n      }\n\n      var key = it.comp.pluginName === 'divider' ? uuid() : it.comp.pluginName;\n      result[it.comp.align].push( /*#__PURE__*/React.createElement(it.comp, {\n        editor: _this2,\n        editorConfig: _this2.config,\n        config: _extends({}, it.comp.defaultConfig || {}, it.config || {}),\n        key: key\n      }));\n    });\n    return result;\n  } // sync left and right section's scroll\n  ;\n\n  _proto.handleSyncScroll = function handleSyncScroll(type, e) {\n    var _this3 = this;\n\n    // prevent loop\n    if (type !== this.shouldSyncScroll) {\n      return;\n    } // trigger events\n\n\n    if (this.props.onScroll) {\n      this.props.onScroll(e, type);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_SCROLL, e, type); // should sync scroll?\n\n    var _this$config$syncScro = this.config.syncScrollMode,\n        syncScrollMode = _this$config$syncScro === void 0 ? [] : _this$config$syncScro;\n\n    if (!syncScrollMode.includes(type === 'md' ? 'rightFollowLeft' : 'leftFollowRight')) {\n      return;\n    }\n\n    if (this.hasContentChanged && this.nodeMdText.current && this.nodeMdPreviewWrapper.current) {\n      // 计算出左右的比例\n      this.scrollScale = this.nodeMdText.current.scrollHeight / this.nodeMdPreviewWrapper.current.scrollHeight;\n      this.hasContentChanged = false;\n    }\n\n    if (!this.isSyncingScroll) {\n      this.isSyncingScroll = true;\n      requestAnimationFrame(function () {\n        if (_this3.nodeMdText.current && _this3.nodeMdPreviewWrapper.current) {\n          if (type === 'md') {\n            // left to right\n            _this3.nodeMdPreviewWrapper.current.scrollTop = _this3.nodeMdText.current.scrollTop / _this3.scrollScale;\n          } else {\n            // right to left\n            _this3.nodeMdText.current.scrollTop = _this3.nodeMdPreviewWrapper.current.scrollTop * _this3.scrollScale;\n          }\n        }\n\n        _this3.isSyncingScroll = false;\n      });\n    }\n  };\n\n  _proto.renderHTML = function renderHTML(markdownText) {\n    var _this4 = this;\n\n    if (!this.props.renderHTML) {\n      console.error('renderHTML props is required!');\n      return Promise.resolve();\n    }\n\n    var res = this.props.renderHTML(markdownText);\n\n    if (isPromise(res)) {\n      // @ts-ignore\n      return res.then(function (r) {\n        return _this4.setHtml(r);\n      });\n    }\n\n    if (typeof res === 'function') {\n      return this.setHtml(res());\n    }\n\n    return this.setHtml(res);\n  };\n\n  _proto.setHtml = function setHtml(html) {\n    var _this5 = this;\n\n    return new Promise(function (resolve) {\n      _this5.setState({\n        html: html\n      }, resolve);\n    });\n  };\n\n  _proto.handleToggleMenu = function handleToggleMenu() {\n    this.setView({\n      menu: !this.state.view.menu\n    });\n  };\n\n  _proto.handleFocus = function handleFocus(e) {\n    var onFocus = this.props.onFocus;\n\n    if (onFocus) {\n      onFocus(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_FOCUS, e);\n  };\n\n  _proto.handleBlur = function handleBlur(e) {\n    var onBlur = this.props.onBlur;\n\n    if (onBlur) {\n      onBlur(e);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_BLUR, e);\n  }\n  /**\n   * Text area change event\n   * @param {React.ChangeEvent} e\n   */\n  ;\n\n  _proto.handleChange = function handleChange(e) {\n    e.persist();\n    var value = e.target.value; // 触发内部事件\n\n    this.setText(value, e);\n  }\n  /**\n   * Listen paste event to support paste images\n   */\n  ;\n\n  _proto.handlePaste = function handlePaste(e) {\n    if (!this.config.allowPasteImage || !this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent; // @ts-ignore\n\n    var items = (event.clipboardData || window.clipboardData).items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  } // Drag images to upload\n  ;\n\n  _proto.handleDrop = function handleDrop(e) {\n    if (!this.config.onImageUpload) {\n      return;\n    }\n\n    var event = e.nativeEvent;\n\n    if (!event.dataTransfer) {\n      return;\n    }\n\n    var items = event.dataTransfer.items;\n\n    if (items) {\n      e.preventDefault();\n      this.uploadWithDataTransfer(items);\n    }\n  };\n\n  _proto.handleEditorKeyDown = function handleEditorKeyDown(e) {\n    var _this6 = this;\n\n    var keyCode = e.keyCode,\n        key = e.key,\n        currentTarget = e.currentTarget;\n\n    if ((keyCode === 13 || key === 'Enter') && this.composing === false) {\n      var _text = currentTarget.value;\n      var curPos = currentTarget.selectionStart;\n      var lineInfo = getLineAndCol(_text, curPos);\n\n      var emptyCurrentLine = function emptyCurrentLine() {\n        var newValue = currentTarget.value.substr(0, curPos - lineInfo.curLine.length) + currentTarget.value.substr(curPos);\n\n        _this6.setText(newValue, undefined, {\n          start: curPos - lineInfo.curLine.length,\n          end: curPos - lineInfo.curLine.length\n        });\n\n        e.preventDefault();\n      };\n\n      var addSymbol = function addSymbol(symbol) {\n        _this6.insertText(\"\\n\" + symbol, false, {\n          start: symbol.length + 1,\n          end: symbol.length + 1\n        });\n\n        e.preventDefault();\n      }; // Enter key, check previous line\n\n\n      var isSymbol = lineInfo.curLine.match(/^(\\s*?)\\* /);\n\n      if (isSymbol) {\n        if (/^(\\s*?)\\* $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        addSymbol(isSymbol[0]);\n        return;\n      }\n\n      var isOrderList = lineInfo.curLine.match(/^(\\s*?)(\\d+)\\. /);\n\n      if (isOrderList) {\n        if (/^(\\s*?)(\\d+)\\. $/.test(lineInfo.curLine)) {\n          emptyCurrentLine();\n          return;\n        }\n\n        var toInsert = \"\" + isOrderList[1] + (parseInt(isOrderList[2], 10) + 1) + \". \";\n        addSymbol(toInsert);\n        return;\n      }\n    } // 触发默认事件\n\n\n    this.emitter.emit(this.emitter.EVENT_EDITOR_KEY_DOWN, e);\n  } // Handle language change\n  ;\n\n  _proto.handleLocaleUpdate = function handleLocaleUpdate() {\n    this.forceUpdate();\n  }\n  /**\n   * Get elements\n   */\n  ;\n\n  _proto.getMdElement = function getMdElement() {\n    return this.nodeMdText.current;\n  };\n\n  _proto.getHtmlElement = function getHtmlElement() {\n    return this.nodeMdPreviewWrapper.current;\n  }\n  /**\n   * Clear selected\n   */\n  ;\n\n  _proto.clearSelection = function clearSelection() {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(0, 0, 'none');\n    }\n  }\n  /**\n   * Get selected\n   * @return {Selection}\n   */\n  ;\n\n  _proto.getSelection = function getSelection() {\n    var source = this.nodeMdText.current;\n\n    if (!source) {\n      return _extends({}, initialSelection);\n    }\n\n    var start = source.selectionStart;\n    var end = source.selectionEnd;\n    var text = (source.value || '').slice(start, end);\n    return {\n      start: start,\n      end: end,\n      text: text\n    };\n  }\n  /**\n   * Set selected\n   * @param {Selection} to\n   */\n  ;\n\n  _proto.setSelection = function setSelection(to) {\n    if (this.nodeMdText.current) {\n      this.nodeMdText.current.setSelectionRange(to.start, to.end, 'forward');\n      this.nodeMdText.current.focus();\n    }\n  }\n  /**\n   * Insert markdown text\n   * @param type\n   * @param option\n   */\n  ;\n\n  _proto.insertMarkdown = function insertMarkdown(type, option) {\n    if (option === void 0) {\n      option = {};\n    }\n\n    var curSelection = this.getSelection();\n    var decorateOption = option ? _extends({}, option) : {};\n\n    if (type === 'image') {\n      decorateOption = _extends({}, decorateOption, {\n        target: option.target || curSelection.text || '',\n        imageUrl: option.imageUrl || this.config.imageUrl\n      });\n    }\n\n    if (type === 'link') {\n      decorateOption = _extends({}, decorateOption, {\n        linkUrl: this.config.linkUrl\n      });\n    }\n\n    if (type === 'tab' && curSelection.start !== curSelection.end) {\n      var curLineStart = this.getMdValue().slice(0, curSelection.start).lastIndexOf('\\n') + 1;\n      this.setSelection({\n        start: curLineStart,\n        end: curSelection.end\n      });\n    }\n\n    var decorate = getDecorated(curSelection.text, type, decorateOption);\n    var text = decorate.text;\n    var selection = decorate.selection;\n\n    if (decorate.newBlock) {\n      var startLineInfo = getLineAndCol(this.getMdValue(), curSelection.start);\n      var col = startLineInfo.col,\n          curLine = startLineInfo.curLine;\n\n      if (col > 0 && curLine.length > 0) {\n        text = \"\\n\" + text;\n\n        if (selection) {\n          selection.start++;\n          selection.end++;\n        }\n      }\n\n      var afterText = startLineInfo.afterText;\n\n      if (curSelection.start !== curSelection.end) {\n        afterText = getLineAndCol(this.getMdValue(), curSelection.end).afterText;\n      }\n\n      if (afterText.trim() !== '' && afterText.substr(0, 2) !== '\\n\\n') {\n        if (afterText.substr(0, 1) !== '\\n') {\n          text += '\\n';\n        }\n\n        text += '\\n';\n      }\n    }\n\n    this.insertText(text, true, selection);\n  }\n  /**\n   * Insert a placeholder, and replace it when the Promise resolved\n   * @param placeholder\n   * @param wait\n   */\n  ;\n\n  _proto.insertPlaceholder = function insertPlaceholder(placeholder, wait) {\n    var _this7 = this;\n\n    this.insertText(placeholder, true);\n    wait.then(function (str) {\n      var text = _this7.getMdValue().replace(placeholder, str);\n\n      _this7.setText(text);\n    });\n  }\n  /**\n   * Insert text\n   * @param {string} value The text will be insert\n   * @param {boolean} replaceSelected Replace selected text\n   * @param {Selection} newSelection New selection\n   */\n  ;\n\n  _proto.insertText = function insertText(value, replaceSelected, newSelection) {\n    if (value === void 0) {\n      value = '';\n    }\n\n    if (replaceSelected === void 0) {\n      replaceSelected = false;\n    }\n\n    var text = this.state.text;\n    var selection = this.getSelection();\n    var beforeContent = text.slice(0, selection.start);\n    var afterContent = text.slice(replaceSelected ? selection.end : selection.start, text.length);\n    this.setText(beforeContent + value + afterContent, undefined, newSelection ? {\n      start: newSelection.start + beforeContent.length,\n      end: newSelection.end + beforeContent.length\n    } : {\n      start: selection.start,\n      end: selection.start\n    });\n  }\n  /**\n   * Set text, and trigger onChange event\n   * @param {string} value\n   * @param {any} event\n   */\n  ;\n\n  _proto.setText = function setText(value, event, newSelection) {\n    var _this8 = this;\n\n    if (value === void 0) {\n      value = '';\n    }\n\n    var _this$config$onChange = this.config.onChangeTrigger,\n        onChangeTrigger = _this$config$onChange === void 0 ? 'both' : _this$config$onChange;\n    var text = value.replace(/↵/g, '\\n');\n\n    if (this.state.text === value) {\n      return;\n    }\n\n    this.setState({\n      text: text\n    });\n\n    if (this.props.onChange && (onChangeTrigger === 'both' || onChangeTrigger === 'beforeRender')) {\n      this.props.onChange({\n        text: text,\n        html: this.getHtmlValue()\n      }, event);\n    }\n\n    this.emitter.emit(this.emitter.EVENT_CHANGE, value, event, typeof event === 'undefined');\n\n    if (newSelection) {\n      setTimeout(function () {\n        return _this8.setSelection(newSelection);\n      });\n    }\n\n    if (!this.hasContentChanged) {\n      this.hasContentChanged = true;\n    }\n\n    var rendering = this.renderHTML(text);\n\n    if (onChangeTrigger === 'both' || onChangeTrigger === 'afterRender') {\n      rendering.then(function () {\n        if (_this8.props.onChange) {\n          _this8.props.onChange({\n            text: _this8.state.text,\n            html: _this8.getHtmlValue()\n          }, event);\n        }\n      });\n    }\n  }\n  /**\n   * Get text value\n   * @return {string}\n   */\n  ;\n\n  _proto.getMdValue = function getMdValue() {\n    return this.state.text;\n  }\n  /**\n   * Get rendered html\n   * @returns {string}\n   */\n  ;\n\n  _proto.getHtmlValue = function getHtmlValue() {\n    if (typeof this.state.html === 'string') {\n      return this.state.html;\n    }\n\n    if (this.nodeMdPreview.current) {\n      return this.nodeMdPreview.current.getHtml();\n    }\n\n    return '';\n  }\n  /**\n   * Listen keyboard events\n   */\n  ;\n\n  /**\n   * Listen keyboard events\n   * @param {KeyboardEventListener} data\n   */\n  _proto.onKeyboard = function onKeyboard(data) {\n    var _this9 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this9.onKeyboard(it);\n      });\n      return;\n    }\n\n    if (!this.keyboardListeners.includes(data)) {\n      this.keyboardListeners.push(data);\n    }\n  }\n  /**\n   * Un-listen keyboard events\n   * @param {KeyboardEventListener} data\n   */\n  ;\n\n  _proto.offKeyboard = function offKeyboard(data) {\n    var _this10 = this;\n\n    if (Array.isArray(data)) {\n      data.forEach(function (it) {\n        return _this10.offKeyboard(it);\n      });\n      return;\n    }\n\n    var index = this.keyboardListeners.indexOf(data);\n\n    if (index >= 0) {\n      this.keyboardListeners.splice(index, 1);\n    }\n  };\n\n  _proto.handleKeyDown = function handleKeyDown(e) {\n    // 遍历监听数组，找找有没有被监听\n    for (var _iterator3 = _createForOfIteratorHelperLoose(this.keyboardListeners), _step3; !(_step3 = _iterator3()).done;) {\n      var it = _step3.value;\n\n      if (isKeyMatch(e, it)) {\n        e.preventDefault();\n        it.callback(e);\n        return;\n      }\n    } // 如果没有，触发默认事件\n\n\n    this.emitter.emit(this.emitter.EVENT_KEY_DOWN, e);\n  };\n\n  _proto.getEventType = function getEventType(event) {\n    switch (event) {\n      case 'change':\n        return this.emitter.EVENT_CHANGE;\n\n      case 'fullscreen':\n        return this.emitter.EVENT_FULL_SCREEN;\n\n      case 'viewchange':\n        return this.emitter.EVENT_VIEW_CHANGE;\n\n      case 'keydown':\n        return this.emitter.EVENT_KEY_DOWN;\n\n      case 'editor_keydown':\n        return this.emitter.EVENT_EDITOR_KEY_DOWN;\n\n      case 'blur':\n        return this.emitter.EVENT_BLUR;\n\n      case 'focus':\n        return this.emitter.EVENT_FOCUS;\n\n      case 'scroll':\n        return this.emitter.EVENT_SCROLL;\n    }\n  }\n  /**\n   * Listen events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.on = function on(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.on(eventType, cb);\n    }\n  }\n  /**\n   * Un-listen events\n   * @param {EditorEvent} event Event type\n   * @param {any} cb Callback\n   */\n  ;\n\n  _proto.off = function off(event, cb) {\n    var eventType = this.getEventType(event);\n\n    if (eventType) {\n      this.emitter.off(eventType, cb);\n    }\n  }\n  /**\n   * Set view property\n   * Can show or hide: editor, preview, menu\n   * @param {object} to\n   */\n  ;\n\n  _proto.setView = function setView(to) {\n    var _this11 = this;\n\n    var newView = _extends({}, this.state.view, to);\n\n    this.setState({\n      view: newView\n    }, function () {\n      _this11.emitter.emit(_this11.emitter.EVENT_VIEW_CHANGE, newView);\n    });\n  }\n  /**\n   * Get view property\n   * @return {object}\n   */\n  ;\n\n  _proto.getView = function getView() {\n    return _extends({}, this.state.view);\n  }\n  /**\n   * Enter or exit full screen\n   * @param {boolean} enable\n   */\n  ;\n\n  _proto.fullScreen = function fullScreen(enable) {\n    var _this12 = this;\n\n    if (this.state.fullScreen !== enable) {\n      this.setState({\n        fullScreen: enable\n      }, function () {\n        _this12.emitter.emit(_this12.emitter.EVENT_FULL_SCREEN, enable);\n      });\n    }\n  }\n  /**\n   * Register a plugin API\n   * @param {string} name API name\n   * @param {any} cb callback\n   */\n  ;\n\n  _proto.registerPluginApi = function registerPluginApi(name, cb) {\n    this.pluginApis.set(name, cb);\n  };\n\n  _proto.unregisterPluginApi = function unregisterPluginApi(name) {\n    this.pluginApis.delete(name);\n  }\n  /**\n   * Call a plugin API\n   * @param {string} name API name\n   * @param {any} others arguments\n   * @returns {any}\n   */\n  ;\n\n  _proto.callPluginApi = function callPluginApi(name) {\n    var handler = this.pluginApis.get(name);\n\n    if (!handler) {\n      throw new Error(\"API \" + name + \" not found\");\n    }\n\n    for (var _len = arguments.length, others = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      others[_key - 1] = arguments[_key];\n    }\n\n    return handler.apply(void 0, others);\n  }\n  /**\n   * Is full screen\n   * @return {boolean}\n   */\n  ;\n\n  _proto.isFullScreen = function isFullScreen() {\n    return this.state.fullScreen;\n  };\n\n  _proto.uploadWithDataTransfer = function uploadWithDataTransfer(items) {\n    var _this13 = this;\n\n    var onImageUpload = this.config.onImageUpload;\n\n    if (!onImageUpload) {\n      return;\n    }\n\n    var queue = [];\n    Array.prototype.forEach.call(items, function (it) {\n      if (it.kind === 'file' && it.type.includes('image')) {\n        var file = it.getAsFile();\n\n        if (file) {\n          var placeholder = getUploadPlaceholder(file, onImageUpload);\n          queue.push(Promise.resolve(placeholder.placeholder));\n          placeholder.uploaded.then(function (str) {\n            var text = _this13.getMdValue().replace(placeholder.placeholder, str);\n\n            var offset = str.length - placeholder.placeholder.length; // 计算出替换后的光标位置\n\n            var selection = _this13.getSelection();\n\n            _this13.setText(text, undefined, {\n              start: selection.start + offset,\n              end: selection.start + offset\n            });\n          });\n        }\n      } else if (it.kind === 'string' && it.type === 'text/plain') {\n        queue.push(new Promise(function (resolve) {\n          return it.getAsString(resolve);\n        }));\n      }\n    });\n    Promise.all(queue).then(function (res) {\n      var text = res.join('');\n\n      var selection = _this13.getSelection();\n\n      _this13.insertText(text, true, {\n        start: selection.start === selection.end ? text.length : 0,\n        end: text.length\n      });\n    });\n  };\n\n  _proto.render = function render() {\n    var _this14 = this;\n\n    var _this$state = this.state,\n        view = _this$state.view,\n        fullScreen = _this$state.fullScreen,\n        text = _this$state.text,\n        html = _this$state.html;\n    var _this$props = this.props,\n        id = _this$props.id,\n        _this$props$className = _this$props.className,\n        className = _this$props$className === void 0 ? '' : _this$props$className,\n        style = _this$props.style,\n        _this$props$name = _this$props.name,\n        name = _this$props$name === void 0 ? 'textarea' : _this$props$name,\n        autoFocus = _this$props.autoFocus,\n        placeholder = _this$props.placeholder,\n        readOnly = _this$props.readOnly;\n    var showHideMenu = this.config.canView && this.config.canView.hideMenu && !this.config.canView.menu;\n\n    var getPluginAt = function getPluginAt(at) {\n      return _this14.state.plugins[at] || [];\n    };\n\n    var isShowMenu = !!view.menu;\n    var editorId = id ? id + \"_md\" : undefined;\n    var previewerId = id ? id + \"_html\" : undefined;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: id,\n      className: \"rc-md-editor \" + (fullScreen ? 'full' : '') + \" \" + className,\n      style: style,\n      onKeyDown: this.handleKeyDown,\n      onDrop: this.handleDrop\n    }, /*#__PURE__*/React.createElement(NavigationBar, {\n      visible: isShowMenu,\n      left: getPluginAt('left'),\n      right: getPluginAt('right')\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"editor-container\"\n    }, showHideMenu && /*#__PURE__*/React.createElement(ToolBar, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-menu\",\n      title: isShowMenu ? 'hidden menu' : 'show menu',\n      onClick: this.handleToggleMenu\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"expand-\" + (isShowMenu ? 'less' : 'more')\n    }))), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-md \" + (view.md ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      id: editorId,\n      ref: this.nodeMdText,\n      name: name,\n      autoFocus: autoFocus,\n      placeholder: placeholder,\n      readOnly: readOnly,\n      value: text,\n      className: \"section-container input \" + (this.config.markdownClass || ''),\n      wrap: \"hard\",\n      onChange: this.handleChange,\n      onScroll: this.handleInputScroll,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'md';\n      },\n      onKeyDown: this.handleEditorKeyDown,\n      onCompositionStart: function onCompositionStart() {\n        return _this14.composing = true;\n      },\n      onCompositionEnd: function onCompositionEnd() {\n        return _this14.composing = false;\n      },\n      onPaste: this.handlePaste,\n      onFocus: this.handleFocus,\n      onBlur: this.handleBlur\n    })), /*#__PURE__*/React.createElement(\"section\", {\n      className: \"section sec-html \" + (view.html ? 'visible' : 'in-visible')\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      id: previewerId,\n      className: \"section-container html-wrap\",\n      ref: this.nodeMdPreviewWrapper,\n      onMouseOver: function onMouseOver() {\n        return _this14.shouldSyncScroll = 'html';\n      },\n      onScroll: this.handlePreviewScroll\n    }, /*#__PURE__*/React.createElement(HtmlRender, {\n      html: html,\n      className: this.config.htmlClass,\n      ref: this.nodeMdPreview\n    })))));\n  };\n\n  return Editor;\n}(React.Component);\n\nEditor.plugins = [];\nEditor.addLocale = i18n.add.bind(i18n);\nEditor.useLocale = i18n.setCurrent.bind(i18n);\nEditor.getLocale = i18n.getCurrent.bind(i18n);\nexport default Editor;"]},"metadata":{},"sourceType":"module"}